# this is a hashtag, hastags are lines of code that are not ran
# This code was run on Severs at Chicago Botanic Garden
# The first step in STACKS is to demultiplex the data using process_radtags within the STACKS program
# to run this we need to 1) make an output folder for the output and 2) make a barcode file to retrieve our samples

# use the mkdir command to make a new directory (for example below : mkdir kearn_out)
# Use nano for text editing, for example nano barcode will make a new file called barcode. The barcode file should be organized by barcode [tab] sample name. barcodes are found on the library prep summary sheet tab 7
# here is the first five lines in the barcode file used for this code, these first five samples correspond to A1,B1,C1,D1,E1 wells from our sequencing plates - think digestion and normalizing.

GCATG	UBC20
AACCA	P19
CGATC	UBC1
TCGAT	UBC14
TGCAT	P16

#process_radtags is the first step in STACKS This is for both fugatei libraries
process_radtags -1 AFU3_S3_R1_001.fastq.gz  -2 AFU3_S3_R2_001.fastq.gz  -i gzfastq -b fmap_1  -o fugate_raw --inline_null --renz_1 ecoRI --renz_2 mspI --adapter_1 ACACTCTTTCCCTACACGACGCTCTTCCGATCT --adapter_2 GTGACTGGAGTTCAGACGTGTGCTCTTCCGATCT --adapter_mm 2 -r -c -q --force-poly-g-check --threads 10
# reads retained = 97997938 (20%) out of 485022258 
process_radtags -1 AFU4_S4_R1_001.fastq.gz  -2 AFU4_S4_R2_001.fastq.gz  -i gzfastq -b fmap_2  -o fugate_raw --inline_null --renz_1 ecoRI --renz_2 mspI --adapter_1 ACACTCTTTCCCTACACGACGCTCTTCCGATCT --adapter_2 GTGACTGGAGTTCAGACGTGTGCTCTTCCGATCT --adapter_mm 2 -r -c -q --force-poly-g-check --threads 10
# All samples had a enought data to pass on

#Fugatei Denovo assembly
3848 loci passed filtering of r80

## Next up we are going to with vcf tools
vcftools --vcf populations.snps.vcf --maf 0.05 --recode --recode-INFO-all --out maf05 # Kept 1969 Sites #Kearney kept 1522 out of 2024
# Check for missing data per sample
vcftools --vcf maf05.recode.vcf  --missing-indv
# More than half our samples have 50% missing sites or more... go back to denovo assembly and filter by r60

#fugatei with r60 6423 kept 3903
vcftools --vcf populations.snps.vcf --maf 0.05 --recode --recode-INFO-all --out maf05




####### Let's filter the STACKS output with VCFTOOLS
# minor allele filter
vcftools --vcf  3223.vcf --maf 0.05 --recode --recode-INFO-all --out output_maf






